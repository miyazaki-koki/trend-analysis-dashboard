---
name: learn-quiz
description: 理解度テスト。コードの内容についてクイズを出題し、本当に理解しているか確認する。AIに書いてもらったコードの理解度チェックに使用。
allowed-tools: Bash, Read, Glob, Grep
argument-hint: [--selection | --file <path>] [difficulty: easy|medium|hard]
---

# Learn Quiz - 理解度クイズ

AIが生成したコードや変更内容について、理解度を試すクイズを出題します。
「動いたから終わり」ではなく、本当に理解しているかを確認するためのスキルです。

## 目的

> 「今書いてもらったコードの内容について、私の理解度を試すクイズを出して」

受動的にコードを受け取るだけでなく、能動的に理解を確認することで学習効果を高めます。

## 使用方法

```bash
# 現在のブランチの変更についてクイズ（デフォルト）
/learn-quiz

# IDEで選択中のコードについてクイズ
/learn-quiz --selection

# 特定ファイルについてクイズ
/learn-quiz --file src/components/charts/LineChart.tsx

# 難易度を指定
/learn-quiz easy      # 基本的な理解度
/learn-quiz medium    # 応用レベル
/learn-quiz hard      # 深い理解・エッジケース

# 組み合わせ
/learn-quiz --selection hard
```

## 実行フロー

### 1. 対象コードの特定

$ARGUMENTSを解析：

- `--selection` → IDEで選択中のコードを対象
- `--file <path>` → 指定ファイルを対象
- 空 / その他 → 現在のブランチの変更（main比較）を対象

難易度指定（`easy`, `medium`, `hard`）があれば適用、なければ `medium`

### 2. コード分析

対象コードを分析し、以下の観点でクイズポイントを抽出：

- **処理フロー**: 何がどの順序で実行されるか
- **データ変換**: 入力から出力への変換ロジック
- **条件分岐**: どの条件でどの処理が走るか
- **エラーハンドリング**: 例外・エラーの扱い
- **設計判断**: なぜその実装を選んだか

### 3. クイズ出題

**出題数**: 3〜5問（難易度とコード量に応じて調整）

#### 難易度別の出題傾向

| 難易度 | 出題傾向 |
|-------|---------|
| easy | チャート種別、基本的なプロパティ |
| medium | データ構造の理解、条件分岐、型の理解 |
| hard | エッジケース、パフォーマンス、設計判断の理由 |

### 4. 回答待ち & フィードバック

ユーザーの回答を待ち、以下を提供：

- 正解/不正解の判定
- 正解の解説
- 関連する補足知識

## 出力フォーマット

### クイズ出題

```markdown
## 🧠 理解度クイズ

対象: `src/components/charts/LineChart.tsx` の変更内容
難易度: ⭐⭐ (medium)

---

### Q1. 処理フローについて

このコンポーネントで Recharts の ResponsiveContainer を使う理由は？

A) レスポンシブ対応を自動化するため
B) パフォーマンス最適化のため
C) Recharts の推奨プラクティス
D) A と C の両方

---

### Q2. データ構造について

以下のコードで、Line コンポーネントにデータが正しく渡る条件は？

```typescript
<Line dataKey="value" stroke={color} />
```

データ配列の各要素は、どのような構造が必要ですか？

A) { value: number }
B) { date: string, value: number }
C) { date: string, value: number, ... }
D) { [key: string]: any }

---

### Q3. 状態管理について（記述式）

移動平均計算後の結果データを、なぜコンポーネント内で再計算しないのか？
（useMemo を使用している場合）

---

### Q4. Recharts の仕様について

XAxis に dataKey="date" を指定したとき、Recharts がラベルを表示できない場合の原因として最も可能性が高いのは？

A) データが配列でない
B) データ要素に "date" フィールドがない
C) "date" が日付形式（ISO 8601）でない
D) XAxis のコンポーネント定義が不完全

---

### Q5. パフォーマンス（記述式）

このコンポーネントが大量のデータ（10,000+ポイント）でレンダリングする場合、
どのような問題が発生する可能性がありますか？
改善策は何ですか？

---

💡 回答を入力してください（例: Q1: D, Q2: B, Q3: ○○だから, ...）
```

### フィードバック

```markdown
## 📊 クイズ結果

### スコア: 4/5 (80%)

---

### Q1. ✅ 正解！
あなたの回答: D) A と C の両方
→ 正解です。ResponsiveContainer は親の幅に応じて自動リサイズし、
  これは Recharts ドキュメントでも推奨されている実装パターンです。

### Q2. ✅ 正解！
あなたの回答: C) { date: string, value: number, ... }
→ 正解です。各要素に少なくとも date と value フィールドが必要です。
他のフィールドがあってもかまいません。

### Q3. ⭕ 部分点
あなたの回答: 余計な再計算を避けるため
→ 方向性は正しいです！

**補足解説**:
useMemo は、依存配列が変わらない限り前回の計算結果をキャッシュします。
この場合：
- 依存配列に `data` と `window` を指定
- これらが変わらなければ、同じ結果を再利用
- これにより不要な計算（と再レンダリング）を防止

### Q4. ❌ 不正解
あなたの回答: C) "date" が日付形式でない
正解: B) データ要素に "date" フィールドがない

**解説**:
Recharts の XAxis は単純に dataKey で指定されたフィールドを読み込みます。
日付形式は自動で認識され、デフォルトでも表示可能です。
フィールド自体がない場合が、最も可能性の高い原因です。

コードで確認するには:
```javascript
console.log(data);  // 実際のデータ構造を確認
```

### Q5. ✅ 正解！
あなたの回答: レンダリング遅延が発生する。
改善策として、データの集約（例: 1時間ごとに平均化）やサーバーサイド集約を検討すべき。

→ 正解です！大規模データの場合：

**改善パターン:**
1. **データ集約**: 月単位でまとめるなど粒度を下げる
2. **仮想化**: react-window で表示領域のみレンダリング
3. **キャッシング**: 計算結果をサーバーで事前計算
4. **ページネーション**: 期間を分割して読み込み

---

## 🎯 復習ポイント

1. **Recharts の仕様**: 必須フィールド、dataKey の指定方法
2. **パフォーマンス**: 大規模データ時の最適化戦略
3. **React Hooks**: useMemo の効果と依存配列の管理

💡 `/learn-explain` でコードの詳細解説を見ることもできます
```

## クイズの種類

### 選択式（多肢選択）
- 処理フロー、条件分岐、エラーケースの確認に使用
- 明確な正解がある問題

### 記述式
- 設計判断の理由、代替案との比較に使用
- 理解の深さを確認する問題

### コード補完式
- 一部を隠して穴埋め
- 実際に書けるかの確認

```markdown
### Q4. コード補完

以下の Recharts チャートで、`???` に入るコード（データの filter 処理）は？

```typescript
const filteredData = data.filter(item => ???);
```

条件: 2024年1月1日以降のデータのみを取得したい

A) item.date >= '2024-01-01'
B) new Date(item.date) >= new Date('2024-01-01')
C) item.date > '2024-01-01'
D) item.date.getTime() >= new Date('2024-01-01').getTime()
```

## 学習効果を高めるコツ

1. **正直に答える**: わからないときは「わかりません」と答える
2. **解説を読む**: 不正解の問題は特に解説をしっかり読む
3. **再チャレンジ**: 時間を置いて同じコードで再度クイズを受ける
4. **深掘り**: 気になった点は `/learn-explain` で詳しく聞く

## よくある回答パターン

###「ツール提案」が自動で出る場合

**不正解が多い場合**:
```
💡 `/learn-explain` でコードの詳細解説を確認してから、
   再度このクイズに挑戦してみてください。
```

**正解が多い場合**:
```
🎉 理解度が高いです！
   次は `/learn-break` で実装の深い理解を目指してみてください。
```

## 関連スキル

- `/learn-explain` - コードの詳細解説
- `/learn-break` - 意図的に壊して学ぶ
- `/codex-review` - コードレビュー（品質チェック）
